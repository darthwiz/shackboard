<%
  @legacy_mode  = LEGACY_MODE
  @page_title   = "StudentiBicocca.it - il portale degli studenti della Bicocca"
  # links 
  link_forum    = @legacy_mode == :old ? '/portale/forum' :
    url_for(:controller => 'forum', :action => 'list')
  link_channels = @legacy_mode == :old ? '/portale/forum/index.php?gid=24' :
    url_for(:controller => 'forum', :action => 'view', :id => 24)
  link_boards   = @legacy_mode == :old ? '/portale/forum/index.php?gid=51' :
    url_for(:controller => 'forum', :action => 'view', :id => 51)
  link_market   = @legacy_mode == :old ? '/portale/forum/index.php?gid=108' :
    url_for(:controller => 'forum', :action => 'view', :id => 108)
%>
<div id="portal_main">
  <div id="header"><%#Header %>
    <div id="title">
      <h1>StudentiBicocca.it</h1>
      <span id="subtitle">
        Il portale degli Studenti dell'Università di Milano-Bicocca
      </span>
    </div>
    <div id="asb_icon">
      <img src="http://www.studentibicocca.it/portale/immagini-nh/asb_small.png" alt=""/>
    </div>
    <%=render :partial => '/login/login_box'%>
    <div class="spacer"></div>
  </div>
  <div id="portal_left">
    <ul class="column">
      <li id="files"><%#Materiali %>
        <h2>
          <%=link_to 'Materiali', 'http://materiali.studentibicocca.it'%>
        </h2>
        <%#cache('portal/latest_files') do %>
        <%=render :partial => '/welcome/files' %>
        <%#end %>
      </li>
      <li id="boards"><%#Bacheche %>
        <h2><%=link_to 'Bacheche', link_boards%></h2>
        <% cache('portal/51') do %>
        <%=render :partial => '/welcome/boards' %>
        <% end %>
      </li>
    </ul>
  </div>
  <div id="portal_center">
    <ul class="column">
      <li><%#Forum %>
        <h2><%=link_to 'Forum', link_forum %></h2>
        <% cache('portal/25') do %>
        <%=render :partial => '/welcome/forums'%>
        <% end %>
      </li>
      <li><%#Canali tematici %>
        <h2><%=link_to 'Canali tematici', link_channels%></h2>
        <% cache('portal/24') do %>
        <%=render :partial => '/welcome/channels'%>
        <% end %>
      </li>
      <li><%#Cerco/Offro %>
        <h2><%=link_to 'Cerco/Offro', link_market%></h2>
        <% cache('portal/108') do %>
        <%=render :partial => '/welcome/market'%>
        <% end %>
      </li>
    </ul>
  </div>
  <div id="portal_right">
    <ul class="column">
      <li><%#Avvisi %>
        <h2><%=link_to 'Avvisi',
            'http://asb.studentibicocca.it/avvisi/'%></h2>
        <%#cache('portal/latest_announcements') do %>
        <%=render :partial => '/announcement/latest' %>
        <%#end %>
      </li>
      <li><%#Blog%>
        <h2><%=link_to 'Blog', 'javascript:;'%></h2>
        <%=render :partial => 'latest_blog_posts' %>
      </li>
      <% 
      contents = []
      ['servizi', 'iniziative', 'rappresentanti', 'network'].each do |i|
        c = StaticContent.find_or_prepare(i)
        contents << c unless c.nil?
      end
      %>
      <%contents.each do |c|%>
      <li id="<%=domid(c)%>" class="static_content">
        <%=render :partial => '/static_content/editable_static_content',
                  :locals  => { :sc => c }%>
        <div class="spacer"></div>
      </li>
      <%end%>
      <%#Free tech advertisements %>
      <li style="text-align: center;">
        <a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Transitional" height="31" width="88" /></a>
        <a href="http://www.vim.org/"><img src="http://www.studentibicocca.it/portale/forum/images/vim_created.gif" alt="Created with Vim" height="36" width="90" /></a>
        <a href="http://www.rubyonrails.org/"><img src="http://www.studentibicocca.it/portale/forum/images/rails.png" alt="Ruby on Rails" height="100" width="80" /></a>
      </li>
      
    </ul>
  </div>
  <div class="spacer"></div>
  <%=render :partial => '/user/online'%>
  <div id="floating_top_banner" style="display: none; position: absolute; top: 0px; left: 50px;">
    <div style="background-color: white; border: 1px solid black; width: 500px; padding: 0.5em;">
      <a href="http://www.studentibicocca.it/portale/forum/viewthread.php?tid=69776"
         style="font-size: 13px; font-weight: bold;">
        Il mestiere del comico: Zelig
      </a>
      <div>
        <p>
          Gli autori (Gino &amp; Michele e Giancarlo Bozzo), comici e
          presentatori di Zelig interverranno nell'Università Bicocca per
          dialogare con gli studenti su cosa sia e cosa comporti il mestiere del
          comico!
        </p>
        <p>
          E' un evento creato nel contesto del decennale dell'Università e
          organizzato dal dipartimento di Sociologia e dalle associazioni
          studentesche
          <a href="http://asb.studentibicocca.it/">ASB</a>,
          <a href="http://www.b-radio.it/">B-Radio</a>,
          <a href="http://www.isawo.eu/">ISAWO</a>,
          <a href="http://www.sism.org/">SISM</a> e
          <a href="http://www.listedisinistra.org/">LdS</a>
        </p>
        <div align="right">
          <a href="#" onclick="Effect.SlideUp('floating_top_banner');"
             style="color: red;" onmouseover="Effect.SlideUp('floating_top_banner');">chiudi</a>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    Effect.SlideDown('floating_top_banner')
  </script>
</div>
