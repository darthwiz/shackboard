<%
item = {}
tmp  = Pm.new
tmp  = Post.new
tmp  = nil
begin
  case draft.object_type
    when 'Pm'
      draft.object[0].subject = nil if draft.object[0].subject.empty?
      subj = draft.object[0].subject || content_tag('em', "senza oggetto")
      subj = content_tag('strong', subj)
      link = link_to "Messaggio privato", :controller => 'pm', :action => 'new',
        :draft => draft.id
      u    = draft.object[0].to
      if !u.new_record?
        dst = link_to h(u.username), :controller => 'user', :action => 'view',
          :id => u
      else
        dst = content_tag('em', 'utente sconosciuto')
      end
      item[:title] = "#{link} #{subj} per #{dst}"
    when 'Post'
      post  = Post.new
      post  = draft.object[0]
      topic = post.topic
      if topic.nil?
        linktext = "Nuova discussione"
        subj     = post[:subject] || content_tag('em', "senza oggetto")
        subj     = content_tag('strong', subj)
        link     = link_to(linktext, :controller => 'post', :action => 'new',
          :draft => draft)
        title    = "#{link} #{subj} nel forum "
        title   += link_to cleanup(post.forum.name), :controller => 'forum',
          :action => 'view', :id => post.forum
      else
        link   = link_to("Nuovo messaggio", :controller => 'post',
          :action => 'new', :draft => draft)
        title  = "#{link} nella discussione "
        title += link_to(topic.subject, :controller => 'topic',
          :action => 'view' , :id => topic)
      end
      item[:title] = title
  end
  item[:time]   = timestamp_to_date(draft.timestamp)
rescue
  item[:title] = 'bozza non valida'
  item[:time]  = ''
end
item[:delete] = link_to('elimina', '#',
  { :class => 'delete', :id => "draft_delete_#{draft.id}" })
%>
  <dl>
    <dt class="title">
      <%=item[:title]%>
    </dt>
    <dd class="time">
      <%=item[:time]%>
    </dd>
    <dd class="delete">
      <%=item[:delete]%>
    </dd>
  </dl>
